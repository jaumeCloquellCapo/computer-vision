castillo = imread('castillo.pgm');
Castillo_oculto2bits = imread('Castillo_oculto2bits.pgm');

% realizamos una operación AND para de una forma sencilla, permite comparar
% los bits que le indiquemos. Si comparten ponemos una mascara de 1 por
% ejemplo, este en 8 bits vendría representado por 1 0 0 0 0 0 0 0 .
% Entonces en este caso si comparten 1 en la misma posición que la imagen
% el resultado es 1 en caso contrrio 0. De esta forma obtememos el bit
% menos significativo duna forma rápida y sencilla.

% 1 => 1 0 0 0 0 0 0 0 en 8 bits
vacas_2 = bitand(Castillo_oculto2bits,1);

% 3 => 0 1 0 0 0 0 0 0 en 8 bits
vacas_3 = bitand(Castillo_oculto2bits,3);
vacas_3 = double(vacas_3);
vacas_3 = (vacas_3 - min(min(vacas_3))) / (max(max(vacas_3)) - min(min(vacas_3)));


figure,subplot(1,4,1),imshow(Castillo_oculto2bits), title('Original');
subplot(1,4,2),imshow(double(vacas_2)), title('Vaca 2 bits');
subplot(1,4,3),imshow(vacas_3), title('Vaca 3 bits');


% Para recuperar la original encriptada desplazamos el bit más
% significativo y luego desplazamos todo a la izquierda para restar 1 a la
% imagen y sumamos los niveles de gris 
B = bitshift(castillo,-1);
B = bitshift(B,1);
B = B + bitand(Castillo_oculto2bits,1);
subplot(1,4,4),imshow(B), title('Imagen encriptada');





%% Recuperación de la imagen 
%Para recuperar la imagen de las vacas tenemos que realizar un procedimiento a nivel de bit que consiste en los siguientes pasos:
%Desplazar todos los bits a la izquierda 6 posiciones, nos da como resultado la imagen de las vacas con tres tonos de grises.
%Desplazar todos los bits a la izquierda 7 posiciones, nos da como resultado la imagen de las vacas con dos tonos de grises.

%Cargar las imágenes, original y encriptada.
Original = imread('castillo.pgm');
Cover = imread('Castillo_oculto2bits.pgm');

% Mover los bits de la imagen 6 posiciones a la derecha:
threegreyscale = bitshift(Cover,6); %imagen de tres escalas de grises
%Si miramos los pixeles del fondo en el inspector nos muestra que esos píxeles tiene el valor 64 y buscamos que este nivel tenga el valor 128, por lo que multiplicamos por 2 cada uno de los píxeles.
threegreyscale = 2.*threegreyscale;

% Para la obtención de la imagen con dos niveles de gris realizamos el mismo proceso pero en lugar de desplazar los bits 6 posiciones los movemos 7.
twogreyscale = bitshift(Cover,7); %imagen de dos escalas de grises
% Como pasaba la imagen inicial da un resultado parecido al deseado, pero más oscuro, Por lo que se necesitaba multiplicar por dos para corregir el nivel de gris al deseado.
twogreyscale = 2.*twogreyscale;

%figure, subplot(1,2,1),imshow(threegreyscale),subplot(1,2,2),imshow(twogreyscale);
figure,subplot(1,4,1),imshow(Cover), title('Original opcio');
subplot(1,4,2),imshow(twogreyscale), title('Vaca 2 bits');
subplot(1,4,3),imshow(threegreyscale), title('Vaca 3 bits');
subplot(1,4,4),imshow(encripted), title('Imagen encriptada');

%% Opción B

% realizamos una operación AND para de una forma sencilla, permite comparar
% los bits que le indiquemos. Si comparten ponemos una mascara de 1 por
% ejemplo, este en 8 bits vendría representado por 1 0 0 0 0 0 0 0 .
% Entonces en este caso si comparten 1 en la misma posición que la imagen
% el resultado es 1 en caso contrrio 0. De esta forma obtememos el bit
% menos significativo duna forma rápida y sencilla.

% 1 => 1 0 0 0 0 0 0 0 en 8 bits
vacas_2 = bitand(Castillo_oculto2bits,1);

% 3 => 0 1 0 0 0 0 0 0 en 8 bits
vacas_3 = bitand(Castillo_oculto2bits,3);
vacas_3 = double(vacas_3);
vacas_3 = (vacas_3 - min(min(vacas_3))) / (max(max(vacas_3)) - min(min(vacas_3)));

%%  Recuperación original encriptada

% Para recuperar la original encriptada desplazamos el bit más
% significativo y luego desplazamos todo a la izquierda para restar 1 a la
% imagen y sumamos los niveles de gris 


encripted = bitshift(Original,-1);
encripted = bitshift(encripted,1);
encripted = encripted + bitand(Cover,1);

figure,subplot(1,4,1),imshow(Cover), title('Original');
subplot(1,4,2),imshow(twogreyscale), title('Vaca 2 bits');
subplot(1,4,3),imshow(threegreyscale), title('Vaca 3 bits');
subplot(1,4,4),imshow(encripted), title('Imagen encriptada');

